<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link href="css/student-index.css" rel="stylesheet" />
        <!-- JQuery -->
        <script src="js/jquery-2.1.3.min.js"></script>
        <!-- Bootstrap框架 -->
        <link href="js/bootstrap/css/bootstrap.css" rel="stylesheet" />
        <script src="js/bootstrap/js/bootstrap.min.js"></script>
        <script src="js/app/config.js"></script>
        <!--<script src="js/app/index.js"></script>-->
      <!-- header的js文件 -->
        <script></script>
        <!-- <script src="js/app/searchManager.js"></script> -->
        <!-- header的css样式 -->
        <link rel="stylesheet" href="css/index/header.css" />
        <!-- 自定义Bootstrap样式 -->
        <!-- <link rel="stylesheet" href="css/index/customBootstrap.css" /> -->
        <style>
          .lessons_file {
            height: 48px;
            background: #eee;
            margin-left: 2%;
            width: 96%;
          }
          .lessons_file div.bgIcon{
            color:#fff;
            display: inline-block;
            width: 35px;
             height: 35px;
             line-height: 35px;
             border-radius: 50%;
             background-color: red;
             text-align: center;
             margin-top: 7px;
             margin-left:1.5%;
             float:left;
          }
          .lessons_file a{
            color:grey;
            text-decoration: underline;
          }
          .lessons_file span.list_right{
            float:right;
            margin-right: 19px;
            margin-top:3px;
          }
        </style>
    </head>
    <body>
    <div class="header">
        <div class="logo"></div>
     <div class="dropdown user">
         <button type="button" class="btn dropdown-toggle name" id="dropdownMenu1" data-toggle="dropdown" style="background:inherit;font-size:21px;">黄莎莎
             <span class="caret"></span>
         </button>
         <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
             <li role="presentation">
                 <a role="menuitem" tabindex="-1" href="#" onclick="">个人资料</a>
             </li>
             <li role="presentation">
                 <a role="menuitem" tabindex="-1" href="#">使用帮助</a>
             </li>
             <li role="presentation">
                 <a role="menuitem" tabindex="-1" href="#">关于我们</a>
             </li>
             <li role="presentation" class="divider"></li>
             <li role="presentation">
                 <a role="menuitem" tabindex="-1" href="login.html">退出登陆</a>
             </li>
         </ul>
     </div>
    </div>

    <div class="content-area">
    <div class="row clearfix">
      <div class="col-md-12 column" style="margin:7px 10px;padding:5px 15px;">

   <!-- 按钮触发模态框 -->
   <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal" style="margin-left:2%;">导入课件</button>
   <!-- 模态框（Modal） -->
   <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
       <div class="modal-dialog" style="margin-top:13%;width:450px;">
           <div class="modal-content">
               <div class="modal-header" style="box-shadow:0px 2px 3px 0px #666;background:#e4e4e4;border-radius:6px 6px 0 0;padding:10px;">
                   <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                   <h4 class="modal-title" id="myModalLabel" style="text-align:center;">课件上传</h4>
               </div>
               <div class="modal-body">
                 <form role="form">
                   <div class="form-group">
                     <label for="name">科目</label>
                     <select class="form-control" id="project" style="display:inline-block;width:85%;margin-left:6%;">
                        <option>语文</option>
                        <option>数学</option>
                        <option>英语</option>
                        <option>物理</option>
                        <option>化学</option>
                      </select>
                   </div>
                   <div class="checkbox" id="type">
                     <label class="checkbox-inline" style="left:9%;">
                       <input type="radio" name="optionsRadiosinline" id="optionsRadios3" value="option1" checked>上传文档
                     </label>
                     <label class="checkbox-inline" style="left:14%;">
                       <input type="radio" name="optionsRadiosinline" id="optionsRadios4" value="option2">收藏网页
                     </label>
                   </div>
                   <div class="form-group" id="file">
                     <label for="inputfile">附件</label>
                     <input type="file" id="inputfile" style="display:inline-block;margin-left:6%;">
                     <p class="help-block" style="padding-left:14%;">请选择文档文件</p>
                   </div>
                   <div class="form-group" id="Url">
                   <label for="name">网址</label>
                       <input type="text"  class="form-control" placeholder="输入网址" style="display:inline-block;margin-left:6%;width:85%;" data-placement="top" data-content="以http://或https://开头输入网址" >
                   </div>
                   <div class="form-group">
                   <label for="name">标题</label>
                       <input type="text" id="title" class="form-control" placeholder="输入标题" style="display:inline-block;margin-left:6%;width:85%;" data-placement="bottom" data-content="标题不能为空" >
                   </div>

                 </form>
               </div>
               <div class="modal-footer">
                   <button type="button" class="btn btn-default" data-dismiss="modal" style="position:relative;right:38%;">关闭</button>
                   <button type="submit" class="btn btn-default" style="position:relative;right:35%;" onclick="submit_form();">提交</button>
<!--                    <button type="button" class="btn btn-primary">提交更改</button> -->
               </div>
           </div><!-- /.modal-content -->
       </div><!-- /.modal -->
   </div>
         <button type="button" class="btn btn-default btn-link btn-sm" style="float:right;margin-right:25px;">删除</button>
        <ul class="list-unstyled" style="margin-top:16px;">
          <li class="lessons_file">
            <div class="bgIcon">语</div>
            <span style="float:left;margin-top:3px; margin-left:21px;">
              Lorem ipsum dolor sit amet
              <br>
              <a href="#" >http://www.baidu.com</a>
            </span>
            <span class="list_right"><p style="margin-bottom:6px;">2月23日 13 : 04 星期三</p>
              <label style="margin-left:95px;margin-bottom:2px;">
                <input type="checkbox">
              </label>
            </span>
            <div style="width:94%;height:.8px;margin-left:6%;padding:0px;background-color:#b7b7b7;overflow:hidden;position:relative;bottom:5px;"></div>
          </li>
          <li>
            Consectetur adipiscing elit
          </li>
          <li>
            Integer molestie lorem at massa
          </li>
          <li>
            Facilisis in pretium nisl aliquet
          </li>
          <li>
            Nulla volutpat aliquam velit
          </li>
          <li>
            Faucibus porta lacus fringilla vel
          </li>
          <li>
            Aenean sit amet erat nunc
          </li>
          <li>
            Eget porttitor lorem
          </li>
        </ul>
      </div>
    </div>
    </div>
    <script>
      // 启动提示框插件
    $(function () {
      $("[data-toggle='popover']").popover();


    });
    // 表单数据对象
    var form={

    };
    /**
     * 定义的表单控件对象
     * @type
     */
    // 文件选择框
    var file = $("#inputfile");
    // 文件选择div
    var file_lab = $("#file");
    // 科目
    var project = $("#project");
    //文件上传类型
    var type = $("#type input:checked");
    // 单选框checkbox
    var checkbox = $(".checkbox input");
    // 网址输入栏div
    var url = $("#Url");
    // 网址输入input
    var url_input = url.find("input");

    // 监听单选框事件
    // option1 文档类型
    // option2 收藏网页
    checkbox.on("click",function(){
      var option = $(this).attr("value");
      if(option == "option1"){
        url.hide();
        file_lab.show();
      }else{
        url.show();
        file_lab.hide();
      }
    });
    // 默认是上传文档
    url.hide();

    // 标题输入input
    var title = $("#title");
    var title_div = title.parent();


    // var global_var;
    //
    // 表单验证插件
    Form_Validation(title_div,title);
    Form_Validation(url,url_input);


    // 表单验证方法正文
    function Form_Validation(div,input){

/*      var obj_va = {
          "div" : div,
          "input": input
      }
      function inner(){
         return obj_va;
      }

      global_var = inner;*/

      // 获得holder 文字判断是那个输入框，因为没有加id 和class 用这种方式辨别
      var str = input.attr('placeholder');
      // 网址输入 除了验证弹出框，还有辅助输入弹出框
      var booln = str=="输入网址"?true:false;


      // 以下是输入框的blur 和 focus 方法
      input.blur(function(){

        // 定义的全局setTimeout指针
        if(foc !==undefined){
          clearTimeout(foc);
        }

        // 判断为空与否
        var text = input[0].value;
        if(text.length <=0 ){
          // 添加警告样式
          div.addClass('has-warning');
          // 非网址输入框显示验证提示
          if(!booln){
            input.popover('show');
          }else{
                    // 网址输入验证,如果之前的提示框未消失，
                    // 先hide 再显示新的提示框
                    var popover  = url.find("div");

                    if(popover.length > 0){
                      console.log(6);
                      url_input.popover("hide");

                    }else{
                      console.log(7);
                    }
                    // 插件本身限制，代码执行时间需要等待，
                    // 才能重新隐藏再显示新的提示框
                    url_input.attr('data-content', '网址不能为空或格式不正确');
                    var inputb = setTimeout(function(){
                      showBlur(url,url_input,inputb);
                    },200);
            // 插件冲突有bug ，需要自行定义一个提示框，或者检查代码的冲突
          }

        }else{
          // 输入框内有输入，直接关闭提示框，
          // 在提交的时候再验证合法性
          input.popover("hide");
        }
      });
      // 定义的 全局变量n，用于记数提示框展示的次数。
      var n = 0;
      input.focus(function(event) {
         div.removeClass('has-warning');
         var bl = div.hasClass('has-error');
         n = 0;
         // 全局监听，当focus 到一定状态后，讲当前提示框全部隐藏
         window.foc = setTimeout(function(){
            console.log(input.attr('placeholder') + " focus");
            var focuss = input.attr('placeholder');
            if(focuss == "输入网址"){
              // alert("请输入网址");
              url_input.popover("hide");
              title.popover("hide");
            }else{
              // alert("请输入标题");
              url_input.popover("hide");
            }
         },6000);
         // 这是表单验证后，产生的验证提示框
         if(bl){
            var popover  = url.find("div");
            // 同上插件限制，需先隐藏再显示新的提示框
            if(popover.length > 0){
              console.log(8);
              url_input.popover("hide");
            }else{

            }
            var clearE = setTimeout(function(){
              showBlur(div,input,clearE);
            },650);
         }else{
            // 先隐藏之前已经出现的提示框再显示新的
            if(booln){
              var popover  = url.find("div");
              input.attr('data-content', '以http://或https://开头输入网址');
                if(popover.length> 0){
                  input.popover("hide");
                }else{
                  // if(!div.hasClass('has-error')){
                  //   console.log(5);

                  // }
                }
                var inputf = setTimeout(function(){
                  showBlur(div,input,inputf);
                },200);
            }else{
              input.popover("hide");
            }
         }
         event.preventDefault();
      });

      // popover插件方法，这里做多次调用处理
      input.on('show.bs.popover', function () {
         var bl = div.hasClass('has-warning');
         var bl_e = div.hasClass('has-error');

         if(n>0 ){
          // 当调用次数已经超过一次，禁止插件本身的行为，一切归于手动操作
            if(!bl && !bl_e){
              return false;
            }
         }else{
            // 当调用次数为第一次时，且操作对象是输入网址的时候
            // 执行popover插件本身行为
            if(!bl && !bl_e &&!input.attr('placeholder') == "输入网址"){
               return false;
               // 无论什么情况都禁止调用，
               // 输入标题的focus时候的popover插件行为
            }else if(!bl && !bl_e && input.attr('placeholder') == "输入标题"){
              return false;
            }
         }
         n++;
      });
    }

    // 显示新的提示框
    function showBlur(div,input,timer){
      div.removeClass('has-error');
      input.popover("show");
      clearTimeout(timer);
    }
    //清楚定时器，同事取消错误error 样式
    function clearError(div,input,timer){
      div.removeClass('has-error');
      input.popover("hide");
      clearTimeout(timer);
    }

    // 表单form submit方法，所有对象保存到form 对象中
    function submit_form(){
      var bool = false;
      var url_check = url.find("input")[0].value;
      console.log(url.find("input"));
      form.url = null;
      if(url){
        bool = cl_url(url_check);
        console.log(bool);
      };

      if(bool){
        form.url = url_check;
      }
      // console.log(title[0].value);
      form.project = project[0].value;
      form.type = type[0].value
      // console.log(file);
      form.file = file[0].files[0];
      form.title = title[0].value;
      console.log(form);

      if(!form.title){
        title_div.addClass('has-error');
        // title.focus();
      }
      // 有地址错误focus到url栏，没有focus到标题栏
      if(!form.url){
        url_input.attr('data-content', '网址不能为空或格式不正确');
        url_input.val("");
        url.addClass('has-error');
        url_input.focus();
      }else{
        title.focus();
      }


    }

    // 验证网址合法性
    window.cl_url = function(str){
      var reg = "^((https|http|ftp|rtsp|mms)?://)"
        + "?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?" //ftp的user@
        + "(([0-9]{1,3}\.){3}[0-9]{1,3}" // IP形式的URL- 199.194.52.184
        + "|" // 允许IP和DOMAIN（域名）
        + "([0-9a-z_!~*'()-]+\.)*" // 域名- www.
        + "([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\." // 二级域名
        + "[a-z]{2,6})" // first level domain- .com or .museum
        + "(:[0-9]{1,4})?" // 端口- :80
        + "((/?)|" // a slash isn't required if there is no file name
        + "(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";
      var re = new RegExp(reg);
      if(re.test(str)){
        console.log("true");
        return true;
      }else{
        console.log("false");
        return false;
      }
    }

    </script>
    </body>
</html>
